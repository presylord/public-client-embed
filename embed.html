
<div id="clientBody"></div>
<script src="https://cdn.tailwindcss.com"></script>

<script  type="module">
  import { html, render, useState, useEffect, useRef } from 'https://unpkg.com/htm@3.1.1/preact/standalone.module.js';
  

  const AdvancedSearch = () => {
    const [filterRows, setFilterRows] = useState([{ field: 'Province', operator: 'is', value: '' }]);
  
    const handleAddRow = () => {
      setFilterRows([...filterRows, { field: 'Province', operator: 'is', value: '' }]);
    };

    const handleRemoveRow = (index) => {
        const updatedRows = filterRows.filter((_, idx) => idx !== index);
        setFilterRows(updatedRows);      };
  
    const handleFieldChange = (index, selectedField, selectedFieldValue) => {
      // Update the field for the specific filter row
      const updatedRows = [...filterRows];
      updatedRows[index][selectedField] = selectedFieldValue;
      setFilterRows(updatedRows);
    };
  
  
    const handleSubmit = (e) => {
      e.preventDefault();
      // Use filterRows for search logic
      console.log('Filter data:', filterRows);
    };

    console.log(filterRows)
  
    return (
      html`<form className="flex flex-col justify-center mb-4" onSubmit={handleSubmit}>
        ${filterRows.map((row, index) => (
          html`<div key=${index} className="flex mb-4">
            <select
              className="border border-gray-300 rounded-l px-4 py-2 focus:outline-none"
              value=${row.field}
              name="field"
              onChange=${(e) => handleFieldChange(index, e.target.name, e.target.value)}
            >
                <option value="Province">Province</option>
                <option value="Municipality">Municipality</option>
                <option value="Barangay">Barangay</option>
                <option value="Street">Street</option>
                <option value="Added on">Added on</option>
            </select>
            <select
              className="border border-gray-300 rounded-l px-4 py-2 focus:outline-none"
              value=${row.operator}
              name="operator"
              onChange=${(e) => handleFieldChange(index, e.target.name, e.target.value)}
            >
                <option value="is">is</option>
                <option value="is between" disabled=${row.field !== 'Added on'}>is between</option>
                
            </select>

            <input
              className="border border-gray-300 rounded-l px-4 py-2 focus:outline-none"
              value=${row.value}
              name="value"
              onChange=${(e) => handleFieldChange(index, e.target.name, e.target.value)}
            /> 
            <button
            type="button"
            onClick=${handleAddRow}
            className="bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded"
          >
            +
          </button>
          ${index > 0 && html`<button
            type="button"
            onClick=${()=>handleRemoveRow(index)}
            className="bg-red-500 hover:bg-red-600 text-white font-semibold px-4 py-2 rounded"
          >
            -
          </button>`}
          </div>`
        ))}
        <div className="flex justify-center my-2">
          
          <button
            type="submit"
            className="bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded ml-2"
          >
            Search Property
          </button>
        </div>
      </form>`
    );
  }

  const clientBody = () => {
    const [listings, setListings] = useState([])
    const [total, setTotal] = useState(0)
    const [formData, setFormData] = useState({
      street: '',
      barangay: '',
      municipality: '',
      province: ''
    });

    const [filters, setFilters] = useState([]);



  useEffect(() => {

    (async () =>{
      const res = await fetch('https://api.presylord.com/v1/properties'); // api.example.com
      const data = await res.json();
      setListings(data.documents)
      setTotal(data.total)


    })()

  }, [])

    const handleSubmit = (e) => {
    e.preventDefault()
    console.log(formData);

    (async () =>{
      const res = await fetch('https://api.presylord.com/v1/properties',{
        method: 'POST',
        body: JSON.stringify(formData)
      }); // api.example.com
      const data = await res.json();
      console.log(data.response.documents)
      setListings(data.response.documents)
      setTotal(data.response.total)

    })()

  }

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData({ ...formData, [name]: value.trim() });
  };
 

    return html`
    <div className="container mx-auto p-4">
      <h1 className="text-2xl font-semibold mb-4">Tierra Lista Properties</h1>

      <form className="flex flex-col justify-center mb-4" onSubmit=${handleSubmit}>
        <div className="flex flex-wrap flex-row justify-center">
          <div className=" mb-2 md:mr-2">
            <input
              type="text"
              onChange=${handleChange}
              name="street"
              placeholder="Street"
              className="border border-gray-300 rounded px-4 py-2 w-full"
            />
          </div>
          <div className="mb-2 md:mr-2">
            <input
              type="text"
              onChange=${handleChange}
              name="barangay"
              placeholder="Barangay"
              className="border border-gray-300 rounded px-4 py-2 w-full"
            />
          </div>
          <div className="mb-2 md:mr-2">
            <input
              type="text"
              onChange=${handleChange}
              name="municipality"
              placeholder="Municipality"
              className="border border-gray-300 rounded px-4 py-2 w-full"
            />
          </div>
          <div className="mb-2 md:mr-2">
            <input
              type="text"
              onChange=${handleChange}
              name="province"
              placeholder="Province"
              className="border border-gray-300 rounded px-4 py-2 w-full"
            />
          </div>
        </div>
        <div className="flex justify-center my-2">
          <button
            type="submit"
            className="bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded"
          >
            Search Property
          </button>
        </div>
      </form>

      <${AdvancedSearch}/>

      
      <h3 class="py-3">Results found: ${total}</h3>

      ${listings.length > 0 && listings.map((property) => (
        
        html`<div key=${property.id} className="bg-white p-4 rounded shadow mb-4">
          <h2 className="text-lg font-semibold">${property.street}</h2>
          <p className="text-gray-600">${property.description}</p>
          <p className="text-gray-500 mt-2">
            ${property.barangay}, ${property.municipality}, ${property.province} (${property.postal_code})
          </p>
        </div>`
        
      ))}
    </div>
    `
  }

  render(html`
  <${clientBody} />
  `, document.getElementById('clientBody'));
</script>